<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Doctor Finder System</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(120deg, #e0f2fe, #f8fafc);
    min-height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    width: 420px;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}

h1 {
    text-align: center;
    color: #0f172a;
}

textarea, input {
    width: 100%;
    margin-top: 12px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    font-size: 14px;
}

button {
    width: 100%;
    margin-top: 18px;
    padding: 12px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background: #1e40af;
}

.result {
    margin-top: 20px;
}

.card {
    background: #f1f5f9;
    padding: 12px;
    border-radius: 8px;
    margin-top: 10px;
}

.footer {
    text-align: center;
    margin-top: 15px;
    font-size: 12px;
    color: #64748b;
}
</style>
</head>

<body>

<div class="container">
    <h1>Doctor Finder</h1>

    <textarea id="symptoms" placeholder="Describe your symptoms"></textarea>
    <input id="city" placeholder="Enter your city">

    <button onclick="findDoctors()">Find Doctors</button>

    <div id="result" class="result"></div>

    <div class="footer">
        ‚ö† This is not a medical diagnosis
    </div>
</div>

<script>
console.log("Script loaded");

let userLat = null;
let userLng = null;

async function findDoctors() {
    const symptoms = document.getElementById("symptoms").value;

    if (!symptoms) {
        alert("Please enter symptoms");
        return;
    }

    // ‚úÖ GPS REQUEST ONLY AFTER BUTTON CLICK
    navigator.geolocation.getCurrentPosition(
        async (position) => {
            userLat = position.coords.latitude;
            userLng = position.coords.longitude;

            console.log("GPS:", userLat, userLng);

            const response = await fetch("http://127.0.0.1:5000/find-doctors", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    symptoms: symptoms,
                    lat: userLat,
                    lng: userLng
                })
            });

            const data = await response.json();

            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = `<h3>${data.specialization}</h3>`;

            if (data.doctors.length === 0) {
                resultDiv.innerHTML += "<p>No doctors found</p>";
                return;
            }

            data.doctors.forEach(d => {
                resultDiv.innerHTML += `
                <div class="card">
                    <strong>${d.name}</strong><br>
                    ${d.hospital}<br>
                    üìç ${d.distance_km} km away<br>
                    üìû ${d.phone}
                </div>
                `;
            });
        },
        (error) => {
            alert("Location access is required to find nearby doctors.");
            console.error("GPS error:", error.message);
        }
    );
}
</script>


</body>
</html>
